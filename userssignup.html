<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign Up and Email Verification</title>
  <style>
    /* Your CSS styles exactly as you provided */
    .form-container {
      background-color: #fcfcfc;
      border-radius: 10px;
      width: 320px;
      padding: 25px 30px;
      box-sizing: border-box;
      border: 1px solid lightgray;
      box-shadow: 1px 2px 10px #9ca1a51c;
      font-family: Arial, Helvetica, sans-serif;
      margin: auto;
      margin-top: 30px;
    }
    .form-title-panel {
      font-weight: 600;
      font-size: 1.5rem;
      color: #48595f;
      border-bottom: 2px solid #8080805c;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    label {
      display: block;
      font-weight: 500;
      margin-top: 8px;
      font-size: 0.9rem;
      color: #48595f;
    }
    input {
      width: 100%;
      height: 28px;
      border-radius: 5px;
      border: 1px solid lightgray;
      margin-top: 4px;
      padding-left: 10px;
      font-size: 1rem;
      font-weight: 400;
      color: #545454;
      box-sizing: border-box;
    }
    input[type=checkbox] {
      width: 15px;
      height: 15px;
      margin-top: 9px;
      margin-left: 0;
      vertical-align: middle;
    }
    .input-error {
      color: darkred;
      font-size: 0.8rem;
      margin-top: 1px;
      height: 16px;
    }
    button {
      border: none;
      background-color: #306efb;
      font-weight: 600;
      padding: 10px;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
      font-size: 1.1rem;
    }
    button:hover {
      background-color: #1e49d2;
    }
    .message-box {
      border-radius: 7px;
      font-weight: 600;
      padding: 10px 15px;
      font-size: 1rem;
      margin-bottom: 15px;
      border: 1px solid transparent;
      display: none;
    }
    .message-box.show {
      display: block;
    }
    .message-box.success {
      border-color: #3b7f51;
      background-color: #8ccf7a;
      color: #204411;
    }
    .message-box.error {
      border-color: #a43737;
      background-color: #f18a8a;
      color: #500202;
    }
  </style>
</head>
<body>
  <div class="form-container" id="signup-section">
    <div class="form-title-panel">Sign Up</div>
    <div class="message-box" id="signup-message"></div>

    <form id="signup-form" autocomplete="off" novalidate>
      <label for="firstName">First Name *</label>
      <input type="text" id="firstName" name="firstName" />
      <div class="input-error" id="firstName-error"></div>

      <label for="lastName">Last Name *</label>
      <input type="text" id="lastName" name="lastName" />
      <div class="input-error" id="lastName-error"></div>

      <label for="gender">Gender *</label>
      <input type="text" id="gender" name="gender" />
      <div class="input-error" id="gender-error"></div>

      <label for="mobile">Mobile *</label>
      <input type="text" id="mobile" name="mobile" />
      <div class="input-error" id="mobile-error"></div>

      <label for="city">City *</label>
      <input type="text" id="city" name="city" />
      <div class="input-error" id="city-error"></div>

      <label for="role">Role *</label>
      <input type="text" id="role" name="role" />
      <div class="input-error" id="role-error"></div>

      <label for="messengerLink">Messenger Link *</label>
      <input type="url" id="messengerLink" name="messengerLink" />
      <div class="input-error" id="messengerLink-error"></div>

      <label for="email">Email *</label>
      <input type="email" id="email" name="email" />
      <div class="input-error" id="email-error"></div>

      <label for="password">Password *</label>
      <input type="password" id="password" name="password" />
      <div class="input-error" id="password-error"></div>

      <button type="submit">Sign Up</button>
    </form>
  </div>

  <div class="form-container" id="verification-section" style="display:none;">
    <div class="form-title-panel">Email Verification</div>
    <div class="message-box" id="verify-message"></div>
    <form id="verification-form" autocomplete="off" novalidate>
      <label for="verificationCode">Verification Code *</label>
      <input type="text" id="verificationCode" name="verificationCode" />
      <div class="input-error" id="verificationCode-error"></div>

      <button type="submit">Verify Email</button>
      <button type="button" id="resend-code" style="margin-top: 5px; background-color: #808080;">Resend Code</button>
    </form>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDuRG37e5qWu1kN7aZQVBwyQwj1EbIieHE",
      authDomain: "wcsharearideinitiativeproject.firebaseapp.com",
      projectId: "wcsharearideinitiativeproject",
      storageBucket: "wcsharearideinitiativeproject.firebasestorage.app",
      messagingSenderId: "169826993800",
      appId: "1:169826993800:web:367bee8597df79406b813d",
      measurementId: "G-7RJV9Q4NCT"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();

    // Elements
    const signupSection = document.getElementById('signup-section');
    const verificationSection = document.getElementById('verification-section');

    const signupForm = document.getElementById('signup-form');
    const verificationForm = document.getElementById('verification-form');

    const signupMessageBox = document.getElementById('signup-message');
    const verifyMessageBox = document.getElementById('verify-message');

    // Simple validation function
    function validateField(input) {
      const value = input.value.trim();
      let error = '';
      if (!value) {
        error = 'This field is required';
      } else {
        if (input.id === 'email') {
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(value)) error = 'Invalid email address';
        }
        if (input.id === 'password') {
          if (value.length < 6) error = 'Password must be at least 6 characters';
        }
      }
      document.getElementById(input.id + '-error').textContent = error;
      return !error;
    }

    // Validate all fields in the signup form
    function validateSignupForm() {
      const inputs = signupForm.querySelectorAll('input');
      let valid = true;
      inputs.forEach(input => {
        if (!validateField(input)) valid = false;
      });
      return valid;
    }

    signupForm.addEventListener('submit', async e => {
      e.preventDefault();
      signupMessageBox.className = 'message-box';
      signupMessageBox.textContent = '';

      if (!validateSignupForm()) {
        signupMessageBox.classList.add('error', 'show');
        signupMessageBox.textContent = 'Please fix the errors in the form.';
        return;
      }

      const email = signupForm.email.value.trim();
      const password = signupForm.password.value;

      try {
        // Create user in Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Update user profile with display name (first + last name)
        await user.updateProfile({
          displayName: signupForm.firstName.value.trim() + ' ' + signupForm.lastName.value.trim(),
        });

        // Send email verification
        await user.sendEmailVerification();

        signupMessageBox.classList.remove('error');
        signupMessageBox.classList.add('success', 'show');
        signupMessageBox.textContent = 'Sign up successful! Verification email sent. Please check your inbox.';

        // Hide signup, show verification form
        signupSection.style.display = 'none';
        verificationSection.style.display = 'block';
      } catch (error) {
        signupMessageBox.classList.add('error', 'show');
        signupMessageBox.textContent = error.message;
      }
    });

    verificationForm.addEventListener('submit', async e => {
      e.preventDefault();
      verifyMessageBox.className = 'message-box';
      verifyMessageBox.textContent = '';

      const user = auth.currentUser;
      if (!user) {
        verifyMessageBox.classList.add('error', 'show');
        verifyMessageBox.textContent = 'No user logged in. Please sign up again.';
        return;
      }

      await user.reload(); // Refresh user info

      if (user.emailVerified) {
        verifyMessageBox.classList.add('success', 'show');
        verifyMessageBox.textContent = 'Email successfully verified! You can now log in.';
        // Reset forms or redirect user here
        verificationForm.reset();
      } else {
        verifyMessageBox.classList.add('error', 'show');
        verifyMessageBox.textContent = 'Email not verified yet. Please check your inbox.';
      }
    });

    document.getElementById('resend-code').addEventListener('click', async () => {
      verifyMessageBox.className = 'message-box';
      verifyMessageBox.textContent = '';
      const user = auth.currentUser;
      if (!user) {
        verifyMessageBox.classList.add('error', 'show');
        verifyMessageBox.textContent = 'No user logged in. Please sign up again.';
        return;
      }
      try {
        await user.sendEmailVerification();
        verifyMessageBox.classList.add('success', 'show');
        verifyMessageBox.textContent = 'Verification email resent. Please check your inbox.';
      } catch (error) {
        verifyMessageBox.classList.add('error', 'show');
        verifyMessageBox.textContent = error.message;
      }
    });

    // Add blur validation listeners
    ['firstName', 'lastName', 'gender', 'mobile', 'city', 'role', 'messengerLink', 'email', 'password', 'verificationCode'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('blur', () => validateField(el));
      }
    });
  </script>
</body>
</html>
